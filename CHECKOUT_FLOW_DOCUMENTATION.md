# ๐ ุชุฏูู ุนูููุฉ ุงูุฏูุน ูุน Noon Payment Gateway

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุฑุจุท ุตูุญุฉ ุชูุงุตูู ุงูุนููู ูุจุงุดุฑุฉู ูุน ุจูุงุจุฉ ุงูุฏูุน Noon. ุนูุฏ ุงูุถุบุท ุนูู ุฒุฑ "Continue"ุ ูุชู:
1. ุญูุธ ุงูุทูุจ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
2. ุฅูุดุงุก ุทูุจ ุฏูุน ูู Noon
3. ุชูุฌูู ุงููุณุชุฎุฏู ูุจุงุดุฑุฉ ูุตูุญุฉ ุงูุฏูุน ุงูุฎุงุตุฉ ุจู Noon

## ๐ ุฎุทูุงุช ุงูุนูููุฉ

### 1. ุตูุญุฉ ุงุฎุชูุงุฑ ุงููุทุนู
```
URL: /rest-link
```
- ุนุฑุถ ุฌููุน ุงููุทุงุนู ุงููุชุงุญุฉ
- ุงููุณุชุฎุฏู ูุฎุชุงุฑ ูุทุนู

### 2. ุตูุญุฉ ูุงุฆูุฉ ุงูุทุนุงู
```
URL: /restaurant/{id}
```
- ุนุฑุถ ูุงุฆูุฉ ุงูุทุนุงู ูููุทุนู ุงููุฎุชุงุฑ
- ุงููุณุชุฎุฏู ูุถูู ุงูููุชุฌุงุช ููุณูุฉ
- ูุชู ุญูุธ ุงูุจูุงูุงุช ูู `sessionStorage`:
  - `cartData`: ูุงุฆูุฉ ุงูููุชุฌุงุช
  - `cartTotal`: ุงููุจูุบ ุงูุฅุฌูุงูู
  - `restaurantId`: ูุนุฑู ุงููุทุนู

### 3. ุตูุญุฉ ุชูุงุตูู ุงูุนููู
```
URL: /checkout/customer-details
```

**ุงูุจูุงูุงุช ุงููุทููุจุฉ:**
- ุงูุงุณู ุงููุงูู (Full Name)
- ุฑูู ุงููุงุชู (Phone Number)
- ุฑูู ุงููุจูู (Building No)
- ุงูุทุงุจู (Floor)
- ุฑูู ุงูุดูุฉ (Apartment Number)
- ุงุณู ุงูุดุงุฑุน (Street)
- ููุงุญุธุงุช (Note - ุงุฎุชูุงุฑู)

**ุนูุฏ ุงูุถุบุท ุนูู "Continue":**

1. ูุชู ุงูุชุญูู ูู ูุฌูุฏ ููุชุฌุงุช ูู ุงูุณูุฉ
2. ุฅุฑุณุงู ุทูุจ POST ุฅูู:
   ```
   /checkout/initiate-payment
   ```

3. **ุงูุจูุงูุงุช ุงููุฑุณูุฉ:**
   ```json
   {
     "restaurant_id": 1,
     "full_name": "ุฃุญูุฏ ูุญูุฏ",
     "phone_number": "0501234567",
     "building_no": "123",
     "floor": "ุงูุฃูู",
     "apartment_number": "5",
     "street": "ุดุงุฑุน ุงูููู ููุฏ",
     "note": "ููุงุญุธุงุช ุฅุถุงููุฉ",
     "total": 150.50,
     "cart_items": [
       {
         "id": 1,
         "name": "ุจุฑุฌุฑ",
         "price": 25.00,
         "quantity": 2
       }
     ]
   }
   ```

### 4. ูุนุงูุฌุฉ ุงูุทูุจ ูู ุงูุฎุงุฏู
```
Controller: RestLinkController@initiatePayment
```

**ุงูุฎุทูุงุช:**
1. **ุงูุชุญูู ูู ุงูุจูุงูุงุช** (Validation)
2. **ุญูุธ ุงูุทูุจ** ูู ุฌุฏูู `link_orders`
3. **ุฅูุดุงุก ุทูุจ ุฏูุน** ูู Noon API:
   ```json
   {
     "apiOperation": "INITIATE",
     "order": {
       "amount": 150.50,
       "currency": "SAR",
       "reference": "ORDER-1-1759302507",
       "name": "Order #1",
       "category": "pay"
     },
     "configuration": {
       "returnUrl": "https://advfoodapp.clarastars.com/payment-success?order_id=1",
       "paymentAction": "AUTHORIZE"
     }
   }
   ```
4. **ุงุณุชูุงู ุฑุฏ ูู Noon** ูุญุชูู ุนูู ุฑุงุจุท ุงูุฏูุน
5. **ุฅุฑุฌุงุน ุงูุฑุฏ** ูููุชุตูุญ:
   ```json
   {
     "success": true,
     "checkout_url": "https://pay-test.sa.noonpayments.com/...",
     "order_id": 1
   }
   ```

### 5. ุงูุชูุฌูู ูุตูุญุฉ ุงูุฏูุน
```
ุงููุชุตูุญ ูุชู ุชูุฌููู ุชููุงุฆูุงู ุฅูู:
https://pay-test.sa.noonpayments.com/...
```

**ูู ูุฐู ุงูุตูุญุฉ:**
- ุงููุณุชุฎุฏู ูุฏุฎู ุจูุงูุงุช ุจุทุงูุชู ุงูุงุฆุชูุงููุฉ
- ูุชู ูุนุงูุฌุฉ ุงูุฏูุน ุนุจุฑ Noon
- ุจุนุฏ ุงูุฏูุนุ ูุชู ุงูุชูุฌูู ุฅูู:
  - **ูุฌุงุญ:** `/payment-success?order_id=1`
  - **ูุดู:** `/payment-failed?order_id=1`

## ๐ ุจูุงูุงุช ุงูุงุชุตุงู ุจู Noon

```php
// config/noon.php
'business_id' => 'adv_food'
'application_id' => 'adv-food'
'category' => 'pay'
'currency' => 'SAR'
```

## ๐ ุฌุฏูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุฌุฏูู `link_orders`
```sql
- id
- restaurant_id (FK)
- status (pending/paid/failed)
- full_name
- phone_number
- building_no
- floor
- apartment_number
- street
- note
- total
- cart_items (JSON)
- created_at
- updated_at
```

## ๐งช ุงุฎุชุจุงุฑ ุงููุธุงู

### 1. ุงูุชุฃูุฏ ูู ูุฌูุฏ ุจูุงูุงุช ูู sessionStorage
```javascript
// ูู console ุงููุชุตูุญ:
sessionStorage.getItem('cartData')
sessionStorage.getItem('cartTotal')
sessionStorage.getItem('restaurantId')
```

### 2. ุงุฎุชุจุงุฑ ุจุทุงูุงุช Noon (Sandbox)
- **ูุฌุงุญ:** 4111 1111 1111 1111
- **ูุดู:** 4000 0000 0000 0002
- CVV: ุฃู 3 ุฃุฑูุงู
- ุชุงุฑูุฎ ุงูุงูุชูุงุก: ุฃู ุชุงุฑูุฎ ูุณุชูุจูู

### 3. ูุญุต ุงูุณุฌูุงุช
```bash
tail -f storage/logs/laravel.log
```

## ๐ ุณูุฑ ุงูุนูู ุงููุงูู

```
[ุตูุญุฉ ุงููุทุงุนู] 
    โ ุงุฎุชูุงุฑ ูุทุนู
[ุตูุญุฉ ุงููุงุฆูุฉ]
    โ ุฅุถุงูุฉ ููุชุฌุงุช
[ุชูุงุตูู ุงูุนููู]
    โ ุฅุฏุฎุงู ุงูุจูุงูุงุช + Continue
[ูุนุงูุฌุฉ ูู ุงูุฎุงุฏู]
    โ ุญูุธ ุงูุทูุจ + ุฅูุดุงุก ุทูุจ Noon
[ุตูุญุฉ Noon ููุฏูุน]
    โ ุฅุฏุฎุงู ุจูุงูุงุช ุงูุจุทุงูุฉ
[ูุฌุงุญ/ูุดู]
    โ
[ุตูุญุฉ ุงููุชูุฌุฉ]
```

## โ๏ธ ููุงุท ูููุฉ

1. **ูุฌุจ ูุฌูุฏ ุจูุงูุงุช ูู sessionStorage** ูุจู ุงูุงูุชูุงู ูุตูุญุฉ ุชูุงุตูู ุงูุนููู
2. **ุงููุจูุบ ูุฌุจ ุฃู ูููู ุฃูุซุฑ ูู 0**
3. **ูุนุฑู ุงููุทุนู ูุฌุจ ุฃู ูููู ุตุญูุญ**
4. **ุจูุงูุงุช ุงูุนููู ูุงููุฉ ููุทููุจุฉ**
5. **ุฑุงุจุท returnUrl ูุฌุจ ุฃู ูููู ุตุญูุญ** ูู ุงูุจูุฆุฉ ุงูุฅูุชุงุฌูุฉ

## ๐ ุงูุชูุนูู ูู ุจูุฆุฉ ุงูุฅูุชุงุฌ

ุนูุฏ ุงูุงูุชูุงู ููุฅูุชุงุฌ:
1. ุชุบููุฑ `NOON_API_URL` ูู `.env`
2. ุชุบููุฑ `NOON_API_KEY` ุฅูู ููุชุงุญ ุงูุฅูุชุงุฌ
3. ุชุบููุฑ `NOON_ENVIRONMENT=production`
4. ุงูุชุฃูุฏ ูู `returnUrl` ูุดูุฑ ููุฏูููู ุงูุตุญูุญ

---

**ุขุฎุฑ ุชุญุฏูุซ:** 1 ุฃูุชูุจุฑ 2025
**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุงุณุชุฎุฏุงู

