<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØµÙˆØª Ø§Ù„Ø¨Ø´Ø±ÙŠ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        .test-btn {
            background: #2196F3;
        }
        .test-btn:hover {
            background: #0b7dda;
        }
        #voices-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            background: #f9f9f9;
        }
        .voice-item {
            padding: 8px;
            margin: 4px 0;
            background: white;
            border-left: 3px solid #2196F3;
            cursor: pointer;
        }
        .voice-item:hover {
            background: #e3f2fd;
        }
        .female {
            border-left-color: #E91E63;
        }
        .info {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        .success {
            background: #d4edda;
            border-color: #28a745;
        }
        .error {
            background: #f8d7da;
            border-color: #dc3545;
        }
        #log {
            background: #212529;
            color: #00ff00;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>ğŸ¤ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØµÙˆØª Ø§Ù„Ø¨Ø´Ø±ÙŠ (Web Speech API)</h1>
    
    <div class="card">
        <h2>Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±ÙŠØ¹</h2>
        <button onclick="testVoice()">ğŸ”Š ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø£Ù†Ø«ÙˆÙŠ: "Order Number 1"</button>
        <button class="test-btn" onclick="testAllVoices()">ğŸµ Ø§Ø®ØªØ¨Ø§Ø± ÙƒÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</button>
        <button onclick="loadVoices()">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµÙˆØ§Øª</button>
    </div>

    <div class="card">
        <h2>ğŸ“Š Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
        <div id="system-info"></div>
    </div>

    <div class="card">
        <h2>ğŸ¤ Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© (<span id="voices-count">0</span>)</h2>
        <div id="voices-list"></div>
    </div>

    <div class="card">
        <h2>ğŸ“ Log</h2>
        <div id="log"></div>
    </div>

    <script>
        const log = (message, type = 'info') => {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString('ar-EG');
            const icon = type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'ğŸ“';
            logDiv.innerHTML += `[${timestamp}] ${icon} ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        };

        // Check system capabilities
        function checkSystem() {
            const infoDiv = document.getElementById('system-info');
            let html = '';

            if ('speechSynthesis' in window) {
                html += '<div class="info success">âœ… Web Speech API Ù…Ø¯Ø¹ÙˆÙ… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­</div>';
                log('âœ… Web Speech API supported', 'success');
            } else {
                html += '<div class="info error">âŒ Web Speech API ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­</div>';
                log('âŒ Web Speech API NOT supported', 'error');
            }

            html += `<p><strong>Ø§Ù„Ù…ØªØµÙØ­:</strong> ${navigator.userAgent}</p>`;
            html += `<p><strong>Ø§Ù„Ù„ØºØ©:</strong> ${navigator.language}</p>`;

            infoDiv.innerHTML = html;
        }

        // Load available voices
        function loadVoices() {
            if (!('speechSynthesis' in window)) {
                log('âŒ Speech synthesis not available', 'error');
                return;
            }

            log('ğŸ” Loading voices...');
            
            let voices = speechSynthesis.getVoices();
            
            if (voices.length === 0) {
                log('â³ No voices yet, waiting for onvoiceschanged event...');
                speechSynthesis.onvoiceschanged = () => {
                    voices = speechSynthesis.getVoices();
                    log(`âœ… Loaded ${voices.length} voices via onvoiceschanged`);
                    displayVoices(voices);
                };
                // Try again after a delay
                setTimeout(() => {
                    voices = speechSynthesis.getVoices();
                    if (voices.length > 0) {
                        displayVoices(voices);
                    }
                }, 100);
            } else {
                log(`âœ… Loaded ${voices.length} voices immediately`);
                displayVoices(voices);
            }
        }

        // Display voices list
        function displayVoices(voices) {
            const voicesDiv = document.getElementById('voices-list');
            const countSpan = document.getElementById('voices-count');
            
            countSpan.textContent = voices.length;
            
            if (voices.length === 0) {
                voicesDiv.innerHTML = '<div class="info error">âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ØµÙˆØ§Øª Ù…ØªØ§Ø­Ø©. Ù‚Ø¯ ØªØ­ØªØ§Ø¬ Ù„ØªØ«Ø¨ÙŠØª Ø£ØµÙˆØ§Øª Ø¹Ù„Ù‰ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ´ØºÙŠÙ„.</div>';
                log('âŒ No voices available', 'error');
                return;
            }

            let html = '';
            voices.forEach((voice, index) => {
                const isFemale = voice.name.toLowerCase().includes('female') ||
                                voice.name.toLowerCase().includes('samantha') ||
                                voice.name.toLowerCase().includes('zira') ||
                                voice.name.toLowerCase().includes('hazel') ||
                                voice.name.toLowerCase().includes('karen') ||
                                voice.name.toLowerCase().includes('susan') ||
                                voice.name.toLowerCase().includes('victoria');
                
                const femaleClass = isFemale ? 'female' : '';
                const femaleIcon = isFemale ? 'ğŸ‘© ' : 'ğŸ‘¤ ';
                
                html += `<div class="voice-item ${femaleClass}" onclick="testSpecificVoice(${index})">
                    ${femaleIcon}<strong>${voice.name}</strong> (${voice.lang})
                    ${voice.default ? ' - <em>Ø§ÙØªØ±Ø§Ø¶ÙŠ</em>' : ''}
                    ${voice.localService ? ' - Ù…Ø­Ù„ÙŠ' : ' - Ø¹Ø¨Ø± Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª'}
                </div>`;
            });

            voicesDiv.innerHTML = html;

            // Find female voices
            const femaleVoices = voices.filter(v => 
                v.name.toLowerCase().includes('female') ||
                v.name.toLowerCase().includes('samantha') ||
                v.name.toLowerCase().includes('zira') ||
                v.name.toLowerCase().includes('hazel')
            );

            if (femaleVoices.length > 0) {
                log(`âœ… Found ${femaleVoices.length} female voice(s): ${femaleVoices.map(v => v.name).join(', ')}`, 'success');
            } else {
                log('âš ï¸ No explicit female voices found. Will use default voice with high pitch.', 'info');
            }
        }

        // Test female voice
        function testVoice() {
            if (!('speechSynthesis' in window)) {
                alert('âŒ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Web Speech API');
                return;
            }

            log('ğŸ”Š Testing female voice...');

            // Cancel any ongoing speech
            speechSynthesis.cancel();

            const message = 'Order Number 1';
            const utterance = new SpeechSynthesisUtterance(message);
            utterance.lang = 'en-US';
            utterance.rate = 0.9;
            utterance.pitch = 1.2;
            utterance.volume = 1.0;

            // Try to find a female voice
            const voices = speechSynthesis.getVoices();
            const femaleVoice = voices.find(v =>
                v.name.toLowerCase().includes('samantha') ||
                v.name.toLowerCase().includes('zira') ||
                v.name.toLowerCase().includes('hazel') ||
                v.name.toLowerCase().includes('karen') ||
                v.name.toLowerCase().includes('female')
            ) || voices.find(v => v.lang.includes('en-US')) ||
               voices.find(v => v.lang.includes('en')) ||
               voices[0];

            if (femaleVoice) {
                utterance.voice = femaleVoice;
                log(`ğŸ¤ Using voice: ${femaleVoice.name} (${femaleVoice.lang})`);
            } else {
                log('âš ï¸ No voice selected, using default');
            }

            utterance.onstart = () => {
                log('âœ… Speech started!', 'success');
            };

            utterance.onend = () => {
                log('âœ… Speech ended successfully!', 'success');
            };

            utterance.onerror = (e) => {
                log(`âŒ Speech error: ${e.error}`, 'error');
            };

            try {
                speechSynthesis.speak(utterance);
                log('ğŸ“¤ speechSynthesis.speak() called');
            } catch (error) {
                log(`âŒ Error calling speak(): ${error}`, 'error');
            }
        }

        // Test specific voice by index
        function testSpecificVoice(index) {
            const voices = speechSynthesis.getVoices();
            const voice = voices[index];

            if (!voice) {
                log(`âŒ Voice ${index} not found`, 'error');
                return;
            }

            log(`ğŸ”Š Testing voice: ${voice.name} (${voice.lang})`);

            speechSynthesis.cancel();

            const utterance = new SpeechSynthesisUtterance('Order Number 1');
            utterance.voice = voice;
            utterance.rate = 0.9;
            utterance.pitch = 1.2;
            utterance.volume = 1.0;

            utterance.onstart = () => {
                log(`âœ… Speaking with ${voice.name}`, 'success');
            };

            utterance.onerror = (e) => {
                log(`âŒ Error with ${voice.name}: ${e.error}`, 'error');
            };

            speechSynthesis.speak(utterance);
        }

        // Test all voices
        function testAllVoices() {
            const voices = speechSynthesis.getVoices();
            
            if (voices.length === 0) {
                alert('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ØµÙˆØ§Øª Ù…ØªØ§Ø­Ø©');
                return;
            }

            log(`ğŸµ Testing all ${voices.length} voices...`);
            
            let index = 0;
            const testNext = () => {
                if (index >= voices.length) {
                    log('âœ… Finished testing all voices!', 'success');
                    return;
                }

                const voice = voices[index];
                log(`ğŸ”Š [${index + 1}/${voices.length}] Testing: ${voice.name}`);

                const utterance = new SpeechSynthesisUtterance(`Voice ${index + 1}: ${voice.name}`);
                utterance.voice = voice;
                utterance.rate = 1.0;
                utterance.volume = 1.0;

                utterance.onend = () => {
                    index++;
                    setTimeout(testNext, 500);
                };

                utterance.onerror = (e) => {
                    log(`âŒ Error with ${voice.name}: ${e.error}`, 'error');
                    index++;
                    setTimeout(testNext, 500);
                };

                speechSynthesis.speak(utterance);
            };

            testNext();
        }

        // Initialize on page load
        window.addEventListener('load', () => {
            checkSystem();
            loadVoices();
            
            // Enable speech synthesis by user interaction
            document.addEventListener('click', () => {
                if (!window.speechEnabled) {
                    const silent = new SpeechSynthesisUtterance('');
                    silent.volume = 0;
                    speechSynthesis.speak(silent);
                    speechSynthesis.cancel();
                    window.speechEnabled = true;
                    log('âœ… Speech synthesis enabled by user interaction');
                }
            }, { once: true });
        });
    </script>
</body>
</html>
